<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ä°zmir Harita</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Mapbox CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet" />

  <!-- Proje stilleri -->
  <link rel="stylesheet" href="./style.css" />
</head>
<body>

  <!-- SOL ÃœST: KONTROL PANELÄ° -->
  <div class="control-panel" id="controlPanel">
    <div class="panel-header">
      <strong>Kontrol Paneli</strong>
      <div class="spacer"></div>
      <button id="panelCollapseBtn" class="btn btn-ghost btn-icon" aria-pressed="false" title="Daralt/GeniÅŸlet">â–¾</button>
    </div>

    <div class="panel-body">
      <div class="control-group">
        <label for="distanceInput"><strong>YarÄ±Ã§ap (m):</strong></label>
        <input type="number" id="distanceInput" value="500" min="0" />
      </div>

      <div class="control-group">
        <label for="lineCountSelect"><strong>BaÄŸlantÄ± SayÄ±sÄ±:</strong></label>
        <select id="lineCountSelect">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="20">20</option>
          <option value="50">50</option>
          <option value="all">TÃ¼mÃ¼</option>
        </select>
      </div>

      <div class="control-group">
        <label for="distanceMode"><strong>Mesafe TÃ¼rÃ¼:</strong></label>
        <select id="distanceMode">
          <option value="haversine">KuÅŸbakÄ±ÅŸÄ±</option>
          <option value="network">Yol AÄŸÄ± (Mapbox)</option>
        </select>
        <div id="modeBadge" class="badge badge-warn">Mesafe TÃ¼rÃ¼: KuÅŸbakÄ±ÅŸÄ± (fallback)</div>
      </div>

      <div class="control-group">
        <label for="styleSwitcher"><strong>Harita Stili:</strong></label>
        <select id="styleSwitcher">
          <option value="mapbox://styles/mapbox/light-v10">Light</option>
          <option value="mapbox://styles/mapbox/dark-v10">Dark</option>
          <option value="mapbox://styles/mapbox/streets-v11" selected>Streets</option>
          <option value="mapbox://styles/mapbox/satellite-v9">Satellite</option>
          <option value="mapbox://styles/mapbox/satellite-streets-v11">Satellite Streets</option>
          <option value="mapbox://styles/atakane/cmcj4owsl054801smawlp978f">BayraklÄ± Style</option>
        </select>
      </div>

      <div class="search-wrap">
        <input type="text" id="parcelSearchInput" placeholder="Mahalle veya parsel ara..." />
        <ul id="searchResults"></ul>
        <li></li>
        <li></li>
      </div>

      <div class="button-row">
        <button id="exportExcelButton" class="btn btn-green">Analiz Excel</button>
        <button id="exportProxExcelButton" class="btn btn-purple">Mesafe Excel</button>
        <button id="exportPNGButton"  class="btn btn-blue">Harita PNG</button>
        <!-- Heatmap dÃ¼ÄŸmesi JS tarafÄ±ndan eklenecek -->
        <button id="btnCatChart" class="btn">Kategorisel Grafik</button>
        <button id="btnWeightedChart" class="btn">Mesafeli Grafik</button>
      </div>

      <div class="shortcuts" role="note" aria-labelledby="shortcutsTitle">
        <div id="shortcutsTitle" class="shortcuts-title">KISAYOLLAR</div>
        <ul class="shortcuts-list">
          <li><code>A</code> â€“ Projelerin Dinamik etki analizi (centroid boyutu + renk)</li>
          <li><code>H</code> â€“ Etki alanlarÄ±nÄ± dinamik olarak gÃ¶ster/gizle</li>
          <li><code>K</code> â€“ Kategoriler panelini aÃ§/kapat</li>
          <li><code>C</code> â€“ Kedi GÃ¶nder ğŸ± </li>
          <li><code>1</code> â€“ Num1 - Ã¶nceki projeye geÃ§</li>
          <li><code>3</code> â€“ Num3 - sonraki projeye geÃ§</li>
        </ul>
        <button class="btn" onclick="downloadChartImage('categoryChart', 'kategorisel_grafik.png')">Grafik PNG indir</button>
        <button class="btn" onclick="downloadChartImage('weightedCategoryChart', 'mesafeli_grafik.png')">Grafik PNG indir</button>
      </div>
    </div>

    <div class="panel-grip" aria-hidden="true"></div>
  </div>

  <!-- SAÄ ALT: Hover Toggle + Ã–zet -->
  <div class="right-bottom-stack">
    <button id="hoverToggleBtn" class="btn btn-ghost">YakÄ±n Ã‡evre Analizi: KAPALI</button>

    <div id="categorySummary" class="summary-card" style="display:none;">
      <div class="summary-title">Daire Ä°Ã§i Kategori SayÄ±larÄ±</div>
      <div id="categorySummaryBody">Ä°mleci harita Ã¼zerinde gezdirinâ€¦</div>
    </div>
  </div>

  <!-- KATEGORÄ° EFSANESÄ° (JS ekleyecek) -->
  <div id="categoryLegend" style="display:none;"></div>

  <!-- HARÄ°TA -->
  <div id="map"></div>

  <!-- KÃœTÃœPHANELER (global UMD) -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://unpkg.com/kdbush@4.0.2/dist/kdbush.umd.js"></script>
  <script src="https://unpkg.com/geokdbush@4.0.2/dist/geokdbush.umd.js"></script>

  <!-- Grafik PNG indirme yardÄ±mcÄ±larÄ± -->
  <script>
    window.downloadChartImage = function (canvasId, filename) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) { alert('Canvas bulunamadÄ±.'); return; }
      const link = document.createElement('a');
      link.download = filename;
      link.href = canvas.toDataURL('image/png');
      link.click();
    };
  </script>

  <style>
  .cat-sprite{
    font-size:28px; line-height:1;
    transform: translate(-50%, -50%);
    user-select:none; pointer-events:none;
    filter: drop-shadow(0 2px 3px rgba(0,0,0,.35));
  }
  </style>

    <!-- SAÄ GRAFÄ°K PANELÄ° (drawer) -->
  <div id="chartPanel" class="chart-panel" aria-hidden="true">
    <div class="chart-panel-header">
      <strong id="chartPanelTitle">Analiz Grafikleri</strong>
      <div class="spacer"></div>
      <button id="chartPanelClose" class="btn btn-ghost btn-icon" title="Kapat" aria-label="Kapat">âœ•</button>
    </div>
    <div id="sideChartContainer" class="chart-panel-body">
      <!-- grafikler buraya Ã§izilecek -->
    </div>
  </div>


  <!-- Uygulama -->
  <script type="module" src="./src/main.js"></script>
</body>
</html>




