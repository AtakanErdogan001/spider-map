<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>İzmir Harita</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Mapbox CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet" />

  <!-- Proje stilleri -->
  <link rel="stylesheet" href="./style.css" />
</head>
<body>

  <!-- SOL ÜST: KONTROL PANELİ -->
  <div class="control-panel" id="controlPanel">
    <div class="panel-header">
      <strong>Kontrol Paneli</strong>
      <div class="spacer"></div>
      <button id="panelCollapseBtn" class="btn btn-ghost btn-icon" aria-pressed="false" title="Daralt/Genişlet">▾</button>
    </div>

    <div class="panel-body">
      <div class="control-group">
        <label for="distanceInput"><strong>Yarıçap (m):</strong></label>
        <input type="number" id="distanceInput" value="500" min="0" />
      </div>

      <div class="control-group">
        <label for="lineCountSelect"><strong>Bağlantı Sayısı:</strong></label>
        <select id="lineCountSelect">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="20">20</option>
          <option value="50">50</option>
          <option value="all">Tümü</option>
        </select>
      </div>

      <div class="control-group">
        <label for="distanceMode"><strong>Mesafe Türü:</strong></label>
        <select id="distanceMode">
          <option value="haversine">Kuşbakışı</option>
          <option value="network">Yol Ağı (Mapbox)</option>
        </select>
        <div id="modeBadge" class="badge badge-warn">Mesafe Türü: Kuşbakışı (fallback)</div>
      </div>

      <div class="control-group">
        <label for="styleSwitcher"><strong>Harita Stili:</strong></label>
        <select id="styleSwitcher">
          <option value="mapbox://styles/mapbox/light-v10">Light</option>
          <option value="mapbox://styles/mapbox/dark-v10">Dark</option>
          <option value="mapbox://styles/mapbox/streets-v11" selected>Streets</option>
          <option value="mapbox://styles/mapbox/satellite-v9">Satellite</option>
          <option value="mapbox://styles/mapbox/satellite-streets-v11">Satellite Streets</option>
          <option value="mapbox://styles/atakane/cmcj4owsl054801smawlp978f">Bayraklı Style</option>
        </select>
      </div>

      <div class="search-wrap">
        <input type="text" id="parcelSearchInput" placeholder="Mahalle veya parsel ara..." />
        <ul id="searchResults"></ul>
        <li></li>
        <li></li>
      </div>

      <div class="button-row">
        <button id="exportExcelButton" class="btn btn-green">Analiz Excel</button>
        <button id="exportProxExcelButton" class="btn btn-purple">Mesafe Excel</button>
        <button id="exportPNGButton"  class="btn btn-blue">Harita PNG</button>
        <!-- Heatmap düğmesi JS tarafından eklenecek -->
        <button id="btnCatChart" class="btn">Kategorisel Grafik</button>
        <button id="btnWeightedChart" class="btn">Mesafeli Grafik</button>
      </div>

      <div class="shortcuts" role="note" aria-labelledby="shortcutsTitle">
        <div id="shortcutsTitle" class="shortcuts-title">KISAYOLLAR</div>
        <ul class="shortcuts-list">
          <li><code>A</code> – Projelerin Dinamik etki analizi (centroid boyutu + renk)</li>
          <li><code>H</code> – Etki alanlarını dinamik olarak göster/gizle</li>
          <li><code>K</code> – Kategoriler panelini aç/kapat</li>
          <li><code>1</code> – Num1 - önceki projeye geç</li>
          <li><code>3</code> – Num3 - sonraki projeye geç</li>
        </ul>
        <button class="btn" onclick="downloadChartImage('categoryChart', 'kategorisel_grafik.png')">Grafik PNG indir</button>
        <button class="btn" onclick="downloadChartImage('weightedCategoryChart', 'mesafeli_grafik.png')">Grafik PNG indir</button>
      </div>
    </div>

    <div class="panel-grip" aria-hidden="true"></div>
  </div>

  <!-- SAĞ ALT: Hover Toggle + Özet -->
  <div class="right-bottom-stack">
    <button id="hoverToggleBtn" class="btn btn-ghost">Yakın Çevre Analizi: KAPALI</button>

    <div id="categorySummary" class="summary-card" style="display:none;">
      <div class="summary-title">Daire İçi Kategori Sayıları</div>
      <div id="categorySummaryBody">İmleci harita üzerinde gezdirin…</div>
    </div>
  </div>

  <!-- KATEGORİ EFSANESİ (JS ekleyecek) -->
  <div id="categoryLegend" style="display:none;"></div>

  <!-- HARİTA -->
  <div id="map"></div>

  <!-- KÜTÜPHANELER (global UMD) -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://unpkg.com/kdbush@4.0.2/dist/kdbush.umd.js"></script>
  <script src="https://unpkg.com/geokdbush@4.0.2/dist/geokdbush.umd.js"></script>

  <!-- Grafik PNG indirme yardımcıları -->
  <script>
    window.downloadChartImage = function (canvasId, filename) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) { alert('Canvas bulunamadı.'); return; }
      const link = document.createElement('a');
      link.download = filename;
      link.href = canvas.toDataURL('image/png');
      link.click();
    };
  </script>

    <!-- SAĞ GRAFİK PANELİ (drawer) -->
  <div id="chartPanel" class="chart-panel" aria-hidden="true">
    <div class="chart-panel-header">
      <strong id="chartPanelTitle">Analiz Grafikleri</strong>
      <div class="spacer"></div>
      <button id="chartPanelClose" class="btn btn-ghost btn-icon" title="Kapat" aria-label="Kapat">✕</button>
    </div>
    <div id="sideChartContainer" class="chart-panel-body">
      <!-- grafikler buraya çizilecek -->
    </div>
  </div>


  <!-- Uygulama -->
  <script type="module" src="./src/main.js"></script>
</body>
</html>


